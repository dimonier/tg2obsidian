# tg2obsidian

Эта программа (далее — Бот) использует бесплатную функциональность бота Telegram для сохранения сообщений из группы Telegram в хранилище [Obsidian](https://obsidian.md) на локальном компьютере.

Используемая разметка Markdown подойдёт и для большинства [других программ](https://www.markdownguide.org/tools/), работающих с локальными файлами Markdown.

## Сценарий использования

- Вы _на ходу_ пишете, наговариваете или пересылаете сообщения в личную группу Telegram
- Бот получает новые сообщения из Telegram и сохраняет их в виде заметок, таким образов формируя входящий поток информации прямо в вашем хранилище заметок
- _Позже в спокойной обстановке_ вы обрабатываете эти заметки, разнося информацию из них в подходящие места в своём хранилище

## Возможности

- Все сообщения группируются по датам — на одну дату создаётся одна заметка. Также возможно сохранять сообщения в одну единственную заметку.
- Каждое сообщение в заметке имеет заголовок с отметкой даты и времени.
- В зависимости он настроек сохраняется либо игнорируется форматирование сообщений.
- Для пересланных сообщений добавляется информация об источнике сообщения.
- Фотографии, анимации, видео и документы сохраняются в хранилище и встраиваются в заметку.
- Контакты сохраняются в виде YAML front matter и vcard.
- Для мест создаются ссылки на Google Maps и Яндекс.Карты.
- Есть возможность преобразовывать заметки с определенными ключевыми словами в задачу.
- Есть возможность тегировать заметки с определенными ключевыми словами.
- Есть возможность распознавания речи из голосовых сообщений и аудиосообщений. При этом Бот отправляет распознанный текст в виде ответа на исходное сообщение.

## Установка и настройка

Расширенные инструкции см. на странице [extended_tg2obsidian_manual.ru](extended_tg2obsidian_manual.ru.md)
1. Установите [Python](https://python.org) 3.10+.
2. Установите требуемые зависимости:

```shell
pip install aiogram
pip install beautifulsoup4
pip install lxml
```

3. Если требуется распознавать голосовые сообщения, установите модуль [Whisper](https://github.com/openai/whisper):

```shell
pip install -U openai-whisper
```

4. Установите скомпилированный [FFMPEG](https://ffmpeg.org/download.html) и добавьте путь к исполняемому файлу (в Windows - ffmpeg.exe) в переменную окружения path. Перейдите в папку с данным скриптом и убедитесь, что ffmpeg.exe запускается из неё.
5. Создайте своего бота при помощи https://t.me/BotFather
6. Вставьте токен, полученный от `@botfather`, в соответствующую переменную в файле `config.py` и измените остальные параметры в `config.py` требуемым образом.
7. (Не обязательно). Добавьте созданного выше бота в приватную группу Telegram и сделайте администратором, чтобы он мог читать сообщения.

## Использование

1. Отправляйте/пересылайте сообщения, которые должны попасть в ваше хранилище Obsidian, в свою приватную группу Telegram или напрямую вашему боту.

2. Запустите Бота:
```shell
python tg2obsidian_bot.py
```

- На постоянно работающем компьютере или на сервере Бота можно не выключать. Тогда он будет распознавать речь и заносить заметки в Obsidian в реальном времени.
- Если вы включаете компьютер только на время использования, запускайте Бота непосредственно тогда, когда нужно получить сообщения в Obsidian, а после получения всех сообщений закрывайте программу.

**Важно!** Бот может получить сообщения только за последние 24 часа. Если от момента отправки сообщения до запуска Бота прошло более 24 часов, такое сообщение уже не будет получено Ботом.

## Известные ошибки

Смотрите в разделе [Issues](https://github.com/dimonier/tg2obsidian/issues?q=is%3Aopen+is%3Aissue+label%3Abug).

## Благодарность автору

Если вы хотите поблагодарить автора этого проекта, ваши донаты с благодарностью будут приняты здесь: https://pay.cloudtips.ru/p/1f9bf82f

![](qrCode.png)
